<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flightdash.io</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>   
    <!-- Include FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts-->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Optional AngularJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <!-- Custom files-->
    <link href="./styles.css" rel="stylesheet">

</head>
<body ng-app="checklistApp" ng-controller="ChecklistController">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <!-- Branding Text -->
            <a class="navbar-brand" href="#">
                <i class="fas fa-plane"></i> flightdash.io
            </a>
            
            <!-- Toggler for mobile -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
    
            <!-- Navbar content -->
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <!-- Settings Icon -->
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="modal" data-bs-target="#settingsModal" href="#"><i class="fas fa-cog"></i> Settings</a>
                    </li>
                    <!-- Info Icon -->
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="modal" data-bs-target="#aboutModal" href="#"><i class="fas fa-info-circle"></i> About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4 main-content-container">
        <div class="row mb-5 clearfix">
            <!-- Chat Window -->
            <div class="col-md-4">
                <div class="border bg-light p-3 chat-container">
                    <div class="bg-primary text-white p-2">Pilot Log</div>
                    <div class="mt-3 chat-content chat-bg" id="chat-content" ng-ref="chatContentDiv">
                        <!-- Rendering Messages with ng-repeat -->
                        <div ng-repeat="message in messages" class="text-{{message.color}} chat-msg-bg">
                            <span ng-bind-html="message.text"></span>
                        </div>
                    </div>
                    <input type="text" class="form-control mt-3" ng-model="chatMessage" ng-keypress="sendMessage($event)" id="chat-message" placeholder="Type your message...">

                    <div class="d-flex mt-2 justify-content-start align-items-center">
                        <button class="btn btn-primary" ng-click="sendMessage()" id="send-button">Send</button>
                        <!-- New Colored Buttons -->
                        <button class="btn btn-success ml-2" ng-click="handleButtonPress('A')">A</button>
                        <button class="btn btn-warning ml-2" ng-click="handleButtonPress('B')">B</button>
                        <button class="btn btn-warning ml-2" ng-click="handleButtonPress('C')">C</button>
                        <button class="btn btn-danger ml-2"  ng-click="handleButtonPress('D')">D</button>
                        <button class="btn btn-secondary ml-2"  ng-click="handleButtonPress('Reset')">Reset</button>
                    </div>
                    <div>State: {{ state }}</div>
                    </div>
            </div>
            <!-- Panel of Buttons -->
            <div class="col-md-8">
                <!-- Tabs Header -->
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link" ng-click="activeTab='checklists'" ng-class="{'active': activeTab === 'checklists'}">Checklists</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" ng-click="activeTab='airports'" ng-class="{'active': activeTab === 'airports'}">Airports</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" ng-click="activeTab='flightPlan'" ng-class="{'active': activeTab === 'flightPlan'}">Flight Plan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" ng-click="activeTab='charts'" ng-class="{'active': activeTab === 'charts'}">Charts</a>
                    </li>
                </ul>

                <hr>

                <!-- Checklists Tab -->
                <div ng-show="activeTab === 'checklists'">
                    <div class="row no-gutter">
                        <!-- Preflight -->
                        <div class="col d-flex flex-column align-items-center">
                            <h5 class="custom-header text-center">Preflight</h5>
                            <button class="btn mb-2 uniform-width small-text slim-button" 
                                ng-class="{'btn-primary': walkaroundStarted, 'btn-secondary': !walkaroundStarted}" 
                                ng-click="setState('Walkaround'); startWalkaround()" 
                                ng-disabled="walkaroundStarted">
                                Walkaround
                            </button>
                            <button class="btn mb-2 uniform-width small-text slim-button" 
                                ng-class="{'btn-primary': prePowerChecklistStarted, 'btn-secondary': !prePowerChecklistStarted}"
                                ng-click="setState('Pre-Power Checklist'); startPrePowerChecklist()"
                                ng-disabled="prePowerChecklistStarted">
                                Pre-Power Checklist
                            </button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Cockpit Prep Checklist')">Cockpit Prep Checklist</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Pre-Boarding')">Pre-Boarding</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('MCDU: Init A')">MCDU: Init A</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('EFB')">EFB</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('MCDU: Flight Plan')">MCDU: Flight Plan</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Flight Director')">Flight Director</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('MCDU: Init B')">MCDU: Init B</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('MCDU: Radnav')">MCDU: Radnav</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('MCDU: Perf')">MCDU: Perf</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('IFR Clearance')">IFR Clearance</button>
                        </div>
                
                        <!-- Taxi -->
                        <div class="col d-flex flex-column align-items-center">
                            <h5 class="custom-header text-center">Taxi</h5>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Pushback & Engines')">Pushback & Engines</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Taxi')">Taxi</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Pre-Takeoff')">Pre-Takeoff</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Takeoff')">Takeoff</button>
                        </div>
                
                        <!-- Flight -->
                        <div class="col d-flex flex-column align-items-center">
                            <h5 class="custom-header text-center">Flight</h5>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('After Takeoff')">After Takeoff</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Cruise')">Cruise</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Descent Prep')">Descent Prep</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Descent')">Descent</button>
                        </div>
                
                        <!-- Landing -->
                        <div class="col d-flex flex-column align-items-center">
                            <h5 class="custom-header text-center">Landing</h5>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Approach')">Approach</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Landing')">Landing</button>
                        </div>
                
                        <!-- After-Landing -->
                        <div class="col d-flex flex-column align-items-center">
                            <h5 class="custom-header text-center">After-Landing</h5>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('After Landing Checklist')">After Landing Checklist</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Taxi-2')">Taxi</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Parking')">Parking</button>
                            <button class="btn btn-secondary mb-2 uniform-width small-text slim-button" ng-click="setState('Shutdown')">Shutdown</button>
                        </div>
                    </div>
                </div>

                <!-- Airports Tab -->
                <div ng-show="activeTab === 'airports'">
                    <!-- Content for Airports -->
                    <h5>Airport Data</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group d-flex align-items-center">
                                <input type="text" class="form-control mr-2" id="icaoCode" ng-model="icao" maxlength="4" ng-change="convertToUpperCase()" placeholder="ICAO">
                                <button class="btn btn-primary" ng-click="fetchAirportInfo()">Request</button>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="form-group d-flex align-items-center">
                                <p>Need to find the ICAO? Try searching <a href="https://ourairports.com/" target="_blank">ourairports.com</a></p>
                            </div>
                        </div>
                    </div>
                    <div class="container mt-5" ng-show="airportRequested">
                        <!-- Header for the airport name -->
                        <h3 class="mb-4">{{airportInfo.name}}</h3>

                        <!-- Form with airport details -->
                        <div class="container mb-5">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="fw-bold">Municipality:</label>
                                    <p>{{airportInfo.municipality}}</p>
                                </div>
                                <div class="col-md-4">
                                    <label class="fw-bold">ICAO:</label>
                                    <p>{{airportInfo.icao}}</p>
                                </div>
                                <div class="col-md-4">
                                    <label class="fw-bold">Type:</label>
                                    <p>{{airportInfo.type}}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label class="fw-bold">Wikipedia:</label>
                                    <a href="{{airportInfo.wikipedia}}" target="_blank">{{airportInfo.wikipedia}}</a>
                                </div>
                            </div>
                        </div>

                        <!-- Weather section -->
                            <div class="container mt-4">
                                <div class="alert alert-secondary" role="alert" data-bs-toggle="collapse" href="#weatherSection">
                                    <h4 class="mb-3 d-inline">
                                        Weather Information <i class="fas fa-caret-right" aria-hidden="true" id="weatherCaret"></i>
                                    </h4>
                                </div>
                                <div class="collapse" id="weatherSection">
                                <div class="row mb-2">
                                    <div class="col-md-8">
                                        <label class="fw-bold">METAR:</label>
                                        <p class="small">{{airportInfo.metar}}</p>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="fw-bold">METAR Source:</label>
                                        <p class="small">{{airportInfo.metarSource}}</p>
                                    </div>
                                </div>

                                <div class="row mb-2">
                                    <div class="col-md-3">
                                        <label class="fw-bold">UTC DateTime:</label>
                                        <p class="small">{{metarDateTime}}</p>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="fw-bold">Local DateTime:</label>
                                        <p class="small">{{localDateTime}}</p>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="fw-bold">Wind:</label>
                                        <p class="small">{{metarWind}}</p>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="fw-bold">Visibility:</label>
                                        <p class="small">{{metarVisibility}}</p>
                                    </div>
                                </div>

                                <div class="row mb-2">
                                    <div class="col-md-3">
                                        <label class="fw-bold">Weather:</label>
                                        <p class="small">{{metarWeather}}</p>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="fw-bold">Clouds:</label>
                                        <p class="small">{{metarClouds}}</p>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="fw-bold">Temperature / Dewpoint:</label>
                                        <span class="small">
                                            {{metarTemperatureDewpoint.split('/')[0]}}째C / {{metarTemperatureDewpoint.split('/')[1]}}째C
                                            <br>
                                            {{convertCelsiusToFahrenheit(metarTemperatureDewpoint.split('/')[0]) | number:1}}째F / {{convertCelsiusToFahrenheit(metarTemperatureDewpoint.split('/')[1]) | number:1}}째F
                                        </span>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="fw-bold">Altimeter:</label>
                                        <p class="small">{{metarAltimeter}}</p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <label class="fw-bold">Remarks:</label>
                                        <p class="small">{{metarRemarks}}</p>
                                    </div>
                                </div>
                            </div>
                            </div>

                            <!-- Frequencies section -->
                            <div class="container mt-4">
                                <div class="alert alert-secondary" role="alert" data-bs-toggle="collapse" href="#frequenciesSection">
                                    <h4 class="mb-3 d-inline">
                                        Frequencies <i class="fas fa-caret-right" aria-hidden="true" id="frequenciesCaret"></i>
                                    </h4>
                                </div>
                                <div class="collapse" id="frequenciesSection">
                                
                                <form>
                                    <div class="row mb-2" ng-repeat="freq in airportData.freqs">
                                        <div class="col-md-3">
                                            <label class="fw-bold small">{{freq.description}}:</label>
                                        </div>
                                        <div class="col-md-3">
                                            <p class="small">{{freq.frequency_mhz}}</p>
                                        </div>
                                        <!-- You can add more columns if needed. For now, I've reserved space for two columns per frequency -->
                                    </div>
                                </form>
                            </div>
                            </div>

                        </div>
                    
                </div>
                
                

                <!-- Flight Plan Tab -->
                <div ng-show="activeTab === 'flightPlan'">
                    <a href="https://dispatch.simbrief.com/options/new" target="_blank" class="btn btn-primary">
                        Create SimBrief Flight Plan
                    </a>
                    <button class="btn btn-success" ng-click="fetchFlightPlan()">Load Flight Plan</button>
                    <hr>
                    <div class="fp-scrollable-content" ng-bind-html="flightPlanTrustedHtml"></div>
                </div>

                

                <!-- Charts Tab -->
                <div ng-show="activeTab === 'charts'">
                    <!-- Content for Charts -->
                </div>
                
            </div>
        </div>
    </div>

    <!-- Modals-->
    <!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="settingsModalLabel">Settings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="checklistDropdown">Aircraft Checklist</label>
                <select class="form-select" id="checklistDropdown">
                    <option>Airbus A320 - Default</option>
                    <option>Cessna 172 - mentoneflyingclub.org</option>
                </select>
                <div class="form-check form-switch mt-3">
                    <input class="form-check-input" type="checkbox" id="customChecklistToggle">
                    <label class="form-check-label" for="customChecklistToggle">Custom Checklist</label>
                </div>
                <div id="customChecklistUploader" style="display: none;">
                    <label for="customChecklistUpload" class="mt-3">Custom Checklist CSV</label>
                    <input type="file" class="form-control" id="customChecklistUpload">
                    <a href="#" class="mt-2 d-block">CSV Template</a>
                </div>
                <label for="metarSourceDropdown" class="mt-3">METAR Source</label>
                <select class="form-select" id="metarSourceDropdown" ng-model="metarSource">
                    <option>beta_aviationweather_gov</option>
                    <option>metar_vatsim_net</option>
                </select>
                <div>
                    <label for="simbriefPilotId">SimBrief Pilot ID</label>
                    <input type="text" class="form-control" id="simbriefPilotId" ng-model="simbriefPilotId">
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Save and Close</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- About Modal -->
  <div class="modal fade" id="aboutModal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="aboutModalLabel">About</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <!-- About content here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Terms of Use Modal-->
  <div class="modal fade" id="termsOfUseModal" tabindex="-1" role="dialog" aria-labelledby="termsOfUseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termsOfUseModalLabel">Terms of Use</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="terms"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal-->
<div class="modal fade" id="privacyPolicyModal" tabindex="-1" role="dialog" aria-labelledby="privacyPolicyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="privacyPolicyLabel">Privacy Policy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="privacy-policy"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Support Modal-->
<div class="modal fade" id="supportModal" tabindex="-1" role="dialog" aria-labelledby="supportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="supportModalLabel">Support & Contact</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="support"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

  <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <a href="#" data-bs-toggle="modal" data-bs-target="#termsOfUseModal">Terms of Use</a> |
                <a href="#" data-bs-toggle="modal" data-bs-target="#privacyPolicyModal">Privacy Policy</a> |
                <a href="#" data-bs-toggle="modal" data-bs-target="#supportModal">Support & Contact</a>
            </div>
            <div class="col-md-4 text-end">
                Version: {{ versionNumber }}
            </div>
        </div>
    </div>
</footer>


    <!-- custom JS-->
    <script src="./script.js"></script>
    <script src="./vanilla-js.js"></script>
    
</body>
</html>